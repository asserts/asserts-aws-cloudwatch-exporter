delay: 60
scrapeInterval: 300
discoverECSTasks: true
alertForwardUrl:
tenant:
ecsTaskScrapeConfigs:
  - containerDefinitionName: aws-cloudwatch-exporter
    metricPath: /aws-exporter/actuator/prometheus
#assumeRole: arn:aws:iam::342994379019:role/aws-service-role/config.amazonaws.com/AWSServiceRoleForConfig
regions:
  - us-west-2
namespaces:
  - name: AWS/Lambda
    dimensionFilters:
      FunctionName: .+
    metrics:
      - name: Throttles
        stats:
          - Sum
      - name: ConcurrentExecutions
        stats:
          - Average
          - Maximum
    logs:
      - lambdaFunctionName: (Function.+)|(OrderProcessor)
        logFilterPattern: "About to put message in SQS Queue"
        regexPattern: ".*put message in SQS Queue https://sqs.us-west-2.amazonaws.com/342994379019/(.+)"
        labels:
          "destination_type": "SQSQueue"
          "destination_name": "$1"
  - name: AWS/SQS
    metrics:
      - name: NumberOfMessagesSent
        stats:
          - Sum
  - name: LambdaInsights
    dimensionFilters:
      function_name: .+
    metrics:
      - name: memory_utilization
        stats:
          - Average
          - Maximum
      - name: used_memory_max
        stats:
          - Average
          - Maximum
      - name: cpu_total_time
        stats:
          - Sum
      - name: tx_bytes
        stats:
          - Sum
      - name: rx_bytes
        stats:
          - Sum
discoverResourceTypes:
  - AWS::RDS::DBInstance
  - AWS::RDS::DBCluster
  - AWS::AutoScaling::AutoScalingGroup
  - AWS::DynamoDB::Table
  - AWS::ApiGateway::RestApi
  - AWS::ApiGatewayV2::Api
  - AWS::SNS::Topic
  - AWS::Kinesis::Stream
tagExportConfig:
  includeTags:
    - "kubernetes.io/service-name"
dimensionToLabels:
  - namespace: AWS/EC2
    dimensionName: InstanceId
  - namespace: AWS/AutoScaling
    dimensionName: AutoScalingGroupName
    mapToLabel: label_ec2_amazonaws_com_aws_autoscaling_group_name
    entityType: AutoScalingGroup
  - namespace: AWS/RDS
    dimensionName: DBInstanceIdentifier
  - namespace: AWS/S3
    dimensionName: BucketName
  - namespace: AWS/DynamoDB
    dimensionName: TableName
  - namespace: AWS/SQS
    dimensionName: QueueName
    mapToLabel: topic
    entityType: Topic
  - namespace: AWS/SNS
    dimensionName: TopicName
  - namespace: AWS/Lambda
    dimensionName: FunctionName
  - namespace: AWS/ELB
    dimensionName: LoadBalancerName
  - namespace: AWS/ApplicationELB
    dimensionName: LoadBalancer
  - namespace: AWS/NetworkELB
    dimensionName: LoadBalancer
  - namespace: AWS/ECS
    dimensionName: ServiceName
  - namespace: AWS/ApiGateway
    dimensionName: ApiGateway
  - namespace: AWS/Firehose
    dimensionName: DeliveryStreamName
  - namespace: AWS/Kinesis
    dimensionName: StreamName
  - namespace: AWS/KinesisAnalytics
    dimensionName: Application
relabelConfigs:
  - source_labels: [account_id]
    regex: (.+)
    target_label: asserts_env
    replacement: $1

  - source_labels: [region]
    regex: (.+)
    target_label: asserts_site
    replacement: $1